<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced usages &mdash; Behavioral oneline experiment v1.0.0 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/js/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing" href="contributing.html" />
    <link rel="prev" title="Create an experiment from scratch" href="example.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Behavioral oneline experiment
          </a>
              <div class="version">
                v1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="description.html">Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentations.html">A tour of PyBOLE</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Create an experiment from scratch</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced usages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#custom-styles-and-javascript-for-template">Custom styles and javascript for template</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-media-content-in-session-progress">Dynamic media content in Session Progress</a></li>
<li class="toctree-l2"><a class="reference internal" href="#store-binary-data-into-sessionprogress">Store binary data into SessionProgress</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prepare-server-for-production-mode">Prepare server for production mode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Behavioral oneline experiment</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Advanced usages</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/prise-3d/behavioral-online-study/blob/master/docs/source/usages.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="advanced-usages">
<h1>Advanced usages<a class="headerlink" href="#advanced-usages" title="Permalink to this headline">¶</a></h1>
<div class="section" id="custom-styles-and-javascript-for-template">
<h2>Custom styles and javascript for template<a class="headerlink" href="#custom-styles-and-javascript-for-template" title="Permalink to this headline">¶</a></h2>
<p>It is possible to define specific code of styles or javascript within a page template. For this purpose, you must specify the necessary code in the appropriate block:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Custom styles --&gt;</span>
{% block custom_stylesheets %}
    <span class="p">&lt;</span><span class="nt">style</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media</span><span class="o">=</span><span class="s">&quot;screen&quot;</span><span class="p">&gt;</span>

        <span class="c">/* Add style rules here */</span>

    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
{% endblock %}

{% block content %}
    <span class="c">&lt;!-- Specific content of the block --&gt;</span>
{% endblock %}

<span class="c">&lt;!-- Custom javascript --&gt;</span>
{% block custom_javascripts %}
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello world&#39;</span><span class="p">);</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<p>This can be notably useful when the javascript code or styles are short and specific to the page. Otherwise, it is preferable to use the classic scripts available for all pages.</p>
</div>
<div class="section" id="dynamic-media-content-in-session-progress">
<h2>Dynamic media content in Session Progress<a class="headerlink" href="#dynamic-media-content-in-session-progress" title="Permalink to this headline">¶</a></h2>
<p>Il est possible d’exploiter des images disponibles depuis le dossier <cite>static</cite> comme stimuli. Parfois, il peut être nécessaire de générer une nouvelle image, soit par la fusion de deux autres ou avec d’autres particularités.</p>
<p>Il est important que ces images soit également accessibles lors de la génération. Il faut donc qu’elle soit sauvegardées dans le dossier de ressources externes relatif : <code class="docutils literal notranslate"><span class="pre">settings.RELATIVE_STATIC_URL</span></code>.</p>
<p>Voici un exemple de génération de nouvelle image:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="o">...</span>

<span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

    <span class="n">cornel_box_path</span> <span class="o">=</span> <span class="s1">&#39;resources/images/cornel_box&#39;</span>

    <span class="c1"># need to take care of static media folder</span>
    <span class="n">images_path</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cornel_box_path</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">RELATIVE_STATIC_URL</span><span class="p">,</span> <span class="n">cornel_box_path</span><span class="p">))</span>
            <span class="p">])</span>


    <span class="c1"># access of two random images</span>
    <span class="n">first_image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">RELATIVE_STATIC_URL</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">images_path</span><span class="p">))</span>
    <span class="n">second_image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">RELATIVE_STATIC_URL</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">images_path</span><span class="p">))</span>

    <span class="n">first_image_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">first_image_path</span><span class="p">))</span>
    <span class="n">second_image_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">second_image_path</span><span class="p">))</span>

    <span class="n">final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">first_image_arr</span><span class="p">,</span> <span class="n">second_image_arr</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># save generated image into static folder (need the access of the new image)</span>
    <span class="n">generated_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">RELATIVE_STATIC_URL</span><span class="p">,</span> <span class="s1">&#39;generated&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">generated_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">generated_path</span><span class="p">)</span>

    <span class="c1"># save the image</span>
    <span class="n">output_img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">generated_path</span><span class="p">,</span> <span class="s1">&#39;tmp.png&#39;</span><span class="p">)</span>
    <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">final</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_img_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="store-binary-data-into-sessionprogress">
<h2>Store binary data into SessionProgress<a class="headerlink" href="#store-binary-data-into-sessionprogress" title="Permalink to this headline">¶</a></h2>
<p>If you are using specific templates for your development, you should know that the SessionProgress template has a binary storage field called <code class="docutils literal notranslate"><span class="pre">binary</span></code>.</p>
<p>This makes it possible to save and reload binary python objects using the pickle tool:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="o">...</span>

<span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

    <span class="c1"># example python object</span>
    <span class="n">myObj</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;binary&quot;</span>
        <span class="s2">&quot;answer&quot;</span><span class="p">:</span> <span class="mi">42</span>
    <span class="p">}</span>

    <span class="c1"># store binary object data</span>
    <span class="n">myObj_bytes</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">myObj</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">myObj_bytes</span>

    <span class="c1"># save the current SessionProgress instance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c1"># load current object instance</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="prepare-server-for-production-mode">
<h2>Prepare server for production mode<a class="headerlink" href="#prepare-server-for-production-mode" title="Permalink to this headline">¶</a></h2>
<p>First your need to make sure the whole installation have been done:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python manage.py makemigrations
python manage.pu migrate
bash create_admin.sh
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">webapp/settings.py</span></code>, set:</p>
<ul class="simple">
<li><p>STATIC_ROOT which must point to the folder allowing access to resources from outside (apache2 or Nginx server). Example: <code class="docutils literal notranslate"><span class="pre">/var/www/html/static</span></code>.</p></li>
</ul>
<p>Collect all the static file into a folder allowing access to resources from outside (apache2 or Nginx server):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">collectstatic</span>
</pre></div>
</div>
<p>Then, in the <code class="docutils literal notranslate"><span class="pre">webapp/settings.py</span></code>, you need to update:</p>
<ul class="simple">
<li><p>STATIC_URL with your expected domain name (https//yourdomain.com)</p></li>
<li><p>DEBUG = False</p></li>
<li><p>ALLOWED_HOSTS array with your domain name</p></li>
<li><p>RELATIVE_STATIC_URL which must point to the folder allowing access to resources from outside (apache2 or Nginx server). Example: <code class="docutils literal notranslate"><span class="pre">../../www/html/static</span></code>.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Each time a new style file, a javascript file, a new instance of SessionProgress and any type of external resource is added to the <code class="docutils literal notranslate"><span class="pre">static</span></code> folder, it is necessary to update and restart the server in production.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="example.html" class="btn btn-neutral float-left" title="Create an experiment from scratch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Jérôme BUISINE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>